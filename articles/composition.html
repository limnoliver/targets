<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The composition of target objects • targets</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="The composition of target objects">
<meta property="og:description" content="targets">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">targets</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9003</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="https://wlandau.github.io/targets-manual">Manual</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/wlandau/targets">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="composition_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>The composition of target objects</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/wlandau/targets/blob/master/vignettes/composition.Rmd"><code>vignettes/composition.Rmd</code></a></small>
      <div class="hidden name"><code>composition.Rmd</code></div>

    </div>

    
    
<p>Most of the package’s conceptual challenges and intricacies are expressed in the <code>"target"</code> class, and this decentralization helps <code>targets</code> effectively reason about entire pipelines. This vignette describes the classes that form the building blocks of a target.</p>
<div id="overall-structure" class="section level1">
<h1 class="hasAnchor">
<a href="#overall-structure" class="anchor"></a>Overall structure</h1>
<p>To maximize performance, classes with many instances per workflow are simple environments. Most of these objects lack explicit S3 class attributes, but all of them have formal constructors, helpers, and validators.</p>
<p>The following classes define specialized objects for the fields of targets.</p>
<ul>
<li>Command</li>
<li>Settings</li>
<li>Cache
<ul>
<li>Memory</li>
</ul>
</li>
<li>Value</li>
<li>Metrics</li>
<li>Store
<ul>
<li>File</li>
</ul>
</li>
<li>Subpipeline</li>
<li>Junction</li>
<li>Pedigree</li>
<li>Cue</li>
</ul>
<p>Some types of targets need only some of these objects as fields.</p>
<table class="table">
<thead><tr class="header">
<th>Field</th>
<th>Builder</th>
<th>Stem</th>
<th>Branch</th>
<th>Bud</th>
<th>Pattern</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Command</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr class="even">
<td>Settings</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr class="odd">
<td>Cache</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr class="even">
<td>Value</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr class="odd">
<td>Metrics</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Store</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Subpipeline</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Junction</td>
<td></td>
<td>✓</td>
<td></td>
<td></td>
<td>✓</td>
</tr>
<tr class="odd">
<td>Pedigree</td>
<td></td>
<td></td>
<td>✓</td>
<td>✓</td>
<td></td>
</tr>
<tr class="even">
<td>Cue</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Patternview</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>✓</td>
</tr>
</tbody>
</table>
<p>The class inheritance hierarchy of targets is below, and the orchestration vignette explains why the package is designed this way.</p>
<ul>
<li>Target
<ul>
<li>Bud</li>
<li>Builder
<ul>
<li>Stem</li>
<li>Branch</li>
</ul>
</li>
<li>Pattern</li>
</ul>
</li>
</ul>
</div>
<div id="classes" class="section level1">
<h1 class="hasAnchor">
<a href="#classes" class="anchor"></a>Classes</h1>
<div id="command-class" class="section level2">
<h2 class="hasAnchor">
<a href="#command-class" class="anchor"></a>Command class</h2>
<p>A <code>command</code> object is an abstraction around an R code chunk. It contains an R expression, the names of packages and object dependencies that the expression needs to in order to run, the random seed to run it with, and a string and hash of the expression. The hash is used to help determine if the target is already up to date.</p>
</div>
<div id="settings-class" class="section level2">
<h2 class="hasAnchor">
<a href="#settings-class" class="anchor"></a>Settings class</h2>
<p>A <code>settings</code> object keeps track of the user-defined target-specific configuration settings of the targets, such as the target name, storage format, failure mode, memory management behavior, and branching pattern specification (if applicable).</p>
</div>
<div id="cache-class" class="section level2">
<h2 class="hasAnchor">
<a href="#cache-class" class="anchor"></a>Cache class</h2>
<p>The cache holds the in-memory objects that a command needs in order to run. It contains two <code>memory</code> objects: one for global objects (“imports”) and another for targets. The <code>targets</code> field requires the most maintenance because this is where a target’s upstream dependencies get loaded and unloaded. The package performs a tricky balancing act because a target needs all its dependencies loaded into memory and the time of building, but superfluous objects need to be regularly cleared out in order to conserve resources. Also, buds and branches are loaded under the name of the parent so the command’s expression does not need to change during branching.</p>
</div>
<div id="memory-class" class="section level2">
<h2 class="hasAnchor">
<a href="#memory-class" class="anchor"></a>Memory class</h2>
<p>A <code>memory</code> object is an efficient abstraction around an environment. It contains the environment itself and the names of the objects inside. This layer of abstraction allows us to avoid repeated calls to <code><a href="https://rdrr.io/r/base/names.html">names()</a></code>, thus increasing performance.</p>
</div>
<div id="value-class" class="section level2">
<h2 class="hasAnchor">
<a href="#value-class" class="anchor"></a>Value class</h2>
<p>The <code>value</code> class, also covered in the <code>oop</code> vignette, is a layer around a target’s return value. Having a special <code>value</code> object allows us to easily distinguish between two situations:</p>
<ol style="list-style-type: decimal">
<li>The target did not run or load data from storage yet.</li>
<li>The target did run, but its expression returned <code>NULL</code>.</li>
</ol>
<p>Without a special <code>value</code> class, both (1) and (2) would result in <code>NULL</code> values. But for (1), we have an empty <code>value</code> object instead of <code>NULL</code>.</p>
<p>In addition, the <code>value</code> class has sub-classes for different data iteration/aggregation methods. Users can choose either list-like aggregation and slicing or <code>vctrs</code>-powered aggregation and slicing. This functionality comes in handy for branching.</p>
</div>
<div id="metrics-class" class="section level2">
<h2 class="hasAnchor">
<a href="#metrics-class" class="anchor"></a>Metrics class</h2>
<p>A <code>metrics</code> object stores metadata metrics about the instance of a target’s build, including runtime, as well as warnings, error messages, and tracebacks if applicable. Initially, the <code>metrics</code> object is creates as part of a <code>build</code> object, which is returned by a <code>command</code> object when it is run. Very soon after, the metrics and return value are separated out from the <code>build</code> object and placed directly in the <code>target</code> object.</p>
</div>
<div id="store-class" class="section level2">
<h2 class="hasAnchor">
<a href="#store-class" class="anchor"></a>Store class</h2>
<p>A <code>store</code> object describes how a <code>target</code> stores and queries its return value in file system storage. It contains a <code>file</code> object, as well as methods for managing the file, such as reading, writing, and decisions that involve hashes. The user-selected format of the target in <code>settings</code> determines the sub-class of the <code>store</code>.</p>
</div>
<div id="file-class" class="section level2">
<h2 class="hasAnchor">
<a href="#file-class" class="anchor"></a>File class</h2>
<p>A <code>file</code> object is an abstraction of a collection of files and directories. It contains the paths, as well as the hash, maximum time stamp, and total storage size of the aggregate. The latter two metrics help decide whether to recompute a computationally expensive hash or trust that the hash is already up to date.</p>
</div>
<div id="subpipeline" class="section level2">
<h2 class="hasAnchor">
<a href="#subpipeline" class="anchor"></a>Subpipeline</h2>
<p>A <code>subpipeline</code> is not actually a class of its own, it is just a <code>pipeline</code> object with only the direct dependencies of a particular target and no values or cache objects in those dependencies. Its only purpose is to efficiently assist with the mechanics of worker-side retrieval.</p>
</div>
<div id="junction-class" class="section level2">
<h2 class="hasAnchor">
<a href="#junction-class" class="anchor"></a>Junction class</h2>
<p>A <code>junction</code> serves as a branching specification for patterns and a budding specification for <code>stems</code>. It contains the name of the parent pattern or stem, the names of the children (buds or branches), and the names of the dependencies of each bud or branch. The junction is the explicit representation of the user-defined <code>pattern</code> argument of <code><a href="../reference/tar_target.html">tar_target()</a></code> combined with the hashes of the available dependencies.</p>
</div>
<div id="pedigree-class" class="section level2">
<h2 class="hasAnchor">
<a href="#pedigree-class" class="anchor"></a>Pedigree class</h2>
<p>Whereas junctions are branching specifications for stems and patterns, pedigrees are branching specifications for buds and branches. A pedigree has the name of the parent (pattern or stem) the name of the child (bud or branch) and the integer index of the child in the parent’s junction.</p>
</div>
<div id="cue-class" class="section level2">
<h2 class="hasAnchor">
<a href="#cue-class" class="anchor"></a>Cue class</h2>
<p>A cue object is a collection of rules for deciding whether a target is up to date. <code>targets</code> allows the user to activate or suppress some of these rules to change the conditions under which targets rerun.</p>
</div>
<div id="patternview-class" class="section level2">
<h2 class="hasAnchor">
<a href="#patternview-class" class="anchor"></a>Patternview class</h2>
<p>A patternview object keeps track of the overall status of a all a pattern’s branches as a group. Its helps make it more efficient to keep track of the progress, runtime, and storage size of an entire pattern.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by William Michael Landau.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
